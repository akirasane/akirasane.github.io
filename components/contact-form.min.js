import{validateRequired,validateEmail,validateLength,validateForm}from '../utils/form-validator.js';class ContactForm extends HTMLElement{constructor(){super();this._isLoading = false;this.handleSubmit = this.handleSubmit.bind(this);this.handleFieldBlur = this.handleFieldBlur.bind(this);this.handleFieldInput = this.handleFieldInput.bind(this);}connectedCallback(){this.render();this.setupEventListeners();}render(){this.innerHTML = ` <style>:host{display:block;}.contact-form-container{max-width:600px;margin:0 auto;}.form-group{margin-bottom:20px;}label{display:block;color:#d1d5db;font-size:14px;font-weight:500;margin-bottom:6px;}label .required{color:#ef4444;}input,textarea{width:100%;padding:10px 14px;background:rgba(31,41,55,0.5);border:1px solid rgba(99,102,241,0.2);border-radius:8px;color:#f3f4f6;font-size:15px;transition:all 0.3s ease;font-family:inherit;}input:focus,textarea:focus{outline:none;border-color:#818cf8;background:rgba(31,41,55,0.7);box-shadow:0 0 0 3px rgba(99,102,241,0.1);}input.error,textarea.error{border-color:#ef4444;}textarea{min-height:120px;resize:vertical;}.error-message{display:block;color:#ef4444;font-size:13px;margin-top:4px;min-height:18px;}.error-message:empty{display:none;}.submit-button{width:100%;padding:12px 20px;background:linear-gradient(to right,#6366f1,#a855f7);color:white;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.3s ease;position:relative;overflow:hidden;}.submit-button:hover:not(:disabled){background:linear-gradient(to right,#4f46e5,#9333ea);transform:translateY(-2px);box-shadow:0 8px 16px rgba(99,102,241,0.3);}.submit-button:disabled{opacity:0.6;cursor:not-allowed;transform:none;}.submit-button .button-text{display:inline-block;transition:opacity 0.3s ease;}.submit-button.loading .button-text{opacity:0;}.spinner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 0.8s linear infinite;opacity:0;transition:opacity 0.3s ease;}.submit-button.loading .spinner{opacity:1;}@keyframes spin{to{transform:translate(-50%,-50%)rotate(360deg);}}.notification{padding:12px;border-radius:8px;margin-bottom:20px;font-size:13px;display:none;animation:slideDown 0.3s ease;}.notification.show{display:block;}.notification.success{background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:#10b981;}.notification.error{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#ef4444;}@keyframes slideDown{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}.honeypot{position:absolute;left:-9999px;width:1px;height:1px;opacity:0;pointer-events:none;}</style> <div class="contact-form-container"> <div class="notification" role="alert"></div> <form id="contact-form" novalidate> <!-- Honeypot field for spam prevention --> <input type="text" name="honeypot" class="honeypot" tabindex="-1" autocomplete="off"> <div class="form-group"> <label for="name"> Name <span class="required">*</span> </label> <input type="text" id="name" name="name" required autocomplete="name" aria-required="true" aria-describedby="name-error" > <span class="error-message" id="name-error"></span> </div> <div class="form-group"> <label for="email"> Email <span class="required">*</span> </label> <input type="email" id="email" name="email" required autocomplete="email" aria-required="true" aria-describedby="email-error" > <span class="error-message" id="email-error"></span> </div> <div class="form-group"> <label for="subject"> Subject <span class="required">*</span> </label> <input type="text" id="subject" name="subject" required aria-required="true" aria-describedby="subject-error" > <span class="error-message" id="subject-error"></span> </div> <div class="form-group"> <label for="message"> Message <span class="required">*</span> </label> <textarea id="message" name="message" required aria-required="true" aria-describedby="message-error" ></textarea> <span class="error-message" id="message-error"></span> </div> <button type="submit" class="submit-button"> <span class="button-text">Send Message</span> <span class="spinner"></span> </button> </form> </div> `;this.form = this.querySelector('#contact-form');this.notification = this.querySelector('.notification');this.submitButton = this.querySelector('.submit-button');this.fields ={name:this.querySelector('#name'),email:this.querySelector('#email'),subject:this.querySelector('#subject'),message:this.querySelector('#message'),honeypot:this.querySelector('[name="honeypot"]')};this.errorElements ={name:this.querySelector('#name-error'),email:this.querySelector('#email-error'),subject:this.querySelector('#subject-error'),message:this.querySelector('#message-error')};}setupEventListeners(){this.form.addEventListener('submit',this.handleSubmit);Object.keys(this.fields).forEach(fieldName =>{if(fieldName !== 'honeypot'){this.fields[fieldName].addEventListener('blur',this.handleFieldBlur);this.fields[fieldName].addEventListener('input',this.handleFieldInput);}});}handleFieldInput(event){const field = event.target;const fieldName = field.name;if(this.errorElements[fieldName]){this.clearFieldError(fieldName);}}handleFieldBlur(event){const field = event.target;const fieldName = field.name;this.validateField(fieldName);}validateField(fieldName){const field = this.fields[fieldName];const value = field.value;let errorMessage = '';switch(fieldName){case 'name':if(!validateRequired(value)){errorMessage = 'Name is required';}else if(!validateLength(value,2,100)){errorMessage = 'Name must be between 2 and 100 characters';}break;case 'email':if(!validateRequired(value)){errorMessage = 'Email is required';}else if(!validateEmail(value)){errorMessage = 'Please enter a valid email address';}break;case 'subject':if(!validateRequired(value)){errorMessage = 'Subject is required';}else if(!validateLength(value,3,200)){errorMessage = 'Subject must be between 3 and 200 characters';}break;case 'message':if(!validateRequired(value)){errorMessage = 'Message is required';}else if(!validateLength(value,10,2000)){errorMessage = 'Message must be between 10 and 2000 characters';}break;}if(errorMessage){this.showFieldError(fieldName,errorMessage);return false;}else{this.clearFieldError(fieldName);return true;}}showFieldError(fieldName,message){const field = this.fields[fieldName];const errorElement = this.errorElements[fieldName];if(field && errorElement){field.classList.add('error');field.setAttribute('aria-invalid','true');errorElement.textContent = message;}}clearFieldError(fieldName){const field = this.fields[fieldName];const errorElement = this.errorElements[fieldName];if(field && errorElement){field.classList.remove('error');field.setAttribute('aria-invalid','false');errorElement.textContent = '';}}async handleSubmit(event){event.preventDefault();if(this.fields.honeypot.value){this.showError('Unable to submit form. Please try again.');return;}const formData = this.formData;const validation = validateForm(formData);if(!validation.isValid){Object.keys(validation.errors).forEach(fieldName =>{this.showFieldError(fieldName,validation.errors[fieldName]);});const firstErrorField = Object.keys(validation.errors)[0];if(this.fields[firstErrorField]){this.fields[firstErrorField].focus();}return;}await this.submitForm(formData);}async submitForm(formData){this.setLoading(true);this.hideNotification();try{const endpoint = this.getAttribute('action')|| 'https:const response = await fetch(endpoint,{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({name:formData.name,email:formData.email,subject:formData.subject,message:formData.message,_subject:formData.subject,_captcha:'false'})});if(!response.ok){throw new Error('Form submission failed');}const result = await response.json();if(window.analytics){window.analytics.trackFormSubmission('contact_form',true);}this.showSuccess('Thank you! Your message has been sent successfully.');setTimeout(()=>{this.clearForm();},2000);}catch(error){if(window.analytics){window.analytics.trackFormSubmission('contact_form',false);}this.showError('Unable to send message. Please try again or contact us directly via email.');}finally{this.setLoading(false);}}setLoading(isLoading){this._isLoading = isLoading;if(isLoading){this.submitButton.disabled = true;this.submitButton.classList.add('loading');this.submitButton.setAttribute('aria-busy','true');}else{this.submitButton.disabled = false;this.submitButton.classList.remove('loading');this.submitButton.setAttribute('aria-busy','false');}}showSuccess(message){this.notification.textContent = message;this.notification.className = 'notification success show';this.notification.setAttribute('role','alert');}showError(message){this.notification.textContent = message;this.notification.className = 'notification error show';this.notification.setAttribute('role','alert');}hideNotification(){this.notification.classList.remove('show');}clearForm(){this.form.reset();Object.keys(this.errorElements).forEach(fieldName =>{this.clearFieldError(fieldName);});}get formData(){return{name:this.fields.name.value,email:this.fields.email.value,subject:this.fields.subject.value,message:this.fields.message.value};}}customElements.define('contact-form',ContactForm);